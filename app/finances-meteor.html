<head>
  <title>Divvy</title>
  <!-- <meta name="viewport" content="user-scalable=no, initial-scale=1.0" /> -->
  <meta name="viewport" content="user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
</head>

<body>
</body>

<template name='loading'>
  <div id='loading' class='center page'>
    Loading...
  </div>
</template>

<template name='home'>
  <div id='home' class='center page'>
    <p>
      Welcome! Are you
    </p>
    <ul>
      <li>Owed money?</li>
      <li>Owing money?</li>
      <li>All the above?</li>
    </ul>
    <p>And wanting to end this situation as quickly and painlessly as possible?</p>
    <p>While this app won't make money magically appear in people's bank accounts (slated for version 2.0), it will tell you the simplest way to transfer funds so that everyone gets what they're owed. Or it can be used to make sure you did if fairly if you've already done the divvying.</p> 
    <p>Did I mention it's easy and free?</p>
    <div class='call-to-action-row'>
      <a data-start-button type=button class='center'>Get Started!</a>
    </div>
  </div>
</template>

<template name='create-account'>
  <div id='global-menu' class='clearfix'>
    <p data-flash-message class='pull-left'>{{message}}</p>
  </div>
  <div id='create-account' class='center page'>
    {{#unless disabled}}
    <h1>Create Divvy Account</h1>
    User Name:
    <input type=text name='username'>
    Password:
    <input type=password name='password1'>
    Password (again):
    <input type=password name='password2'>
    <br>
    <a type=button data-create-account-button class='pull-right'>Create Account</a>
    <h1>Or:</h1>
    <a type=button data-login-button class='pull-right'>Log In</a>
    {{/unless}}
    {{#if disabled}}
    <h1>Consolations, account creation is disabled at this time.</h1>
    <br>
    <h1>Check back with us soon.</h1>
    {{/if}}
  </div>
</template>

<template name='login'>
  <div id='global-menu' class='clearfix'>
    <p data-flash-message class='pull-left'>{{message}}</p>
  </div>
  <div id='login' class='center page'>
    <h1>Log In to Divvy</h1>
    User Name:
    <input type=text name='username'>
    Password:
    <input type=password name='password'>
    <br>
    <a type=button data-login-button>Log In</a>
    <h1>Or:</h1>
    <a type=button data-create-account-button>Create Account</a>
  </div>
</template>

<template name='global-menu'>
  <div id='global-menu' class='clearfix'>
    {{#if user}}
    <a data-logout-button type=button class="pull-left">log out</a>
    {{/if}}
    {{#if scenario}}
    <a data-reset-button type=button class="pull-left" title='Clear all data and start over'>reset &times;</a>
    {{/if}}
    <h1>{{#if scenario}}&ldquo;{{scenario.name}}&rdquo; by {{/if}}{{#if creator}}{{creator.username}}{{/if}}</h1>
    <p data-flash-message class='pull-left'>{{message}}</p>
    <a data-next-button type=button class='pull-right {{#if nextButtonDisabled}}disabled{{/if}}'>next &gt;</a>
    <a data-up-button type=button class='pull-right {{#if upButtonDisabled}}disabled{{/if}}'>up ^</a>
  </div> 
</template>

<template name='scenario-form'>
  {{> global-menu}}
  <div id='scenario-form' class='center page'>
    <h1>Create or choose a 'scenario'</h1>
    <ul>
      <li>
        <input type='text' placeholder='Name' value="{{name}}" name='scenario-name'><a type='button' data-add-button data-item='{{name}}'>&check;</a>
      </li>
      {{#each scenarios}}
      <li>
        <a data-link href='{{pathFor "scenario-detail"}}'>{{name}}</a><a type='button' data-remove-button data-scenario='{{_id}}'>&times;</a>
      </li>
      {{/each}}
    </ul>
    <a type=button id='more-button' href='/find-scenario'>More &gt;</a>
  </div>
</template>

<template name='find-scenario'>
  {{> global-menu}}
  <div id='find-scenario' class='center page'>
    <h1>Find a 'scenario'</h1>
    Enter the User Name of the person who created the scenario.
    <input type=text placeholder='User Name' name='user-name'><a type='button' data-search-button data-item='{{name}}'>*</a>
    <ul>
      {{#each scenarios}}
      <li><a data-link href='{{pathFor "account-form"}}'>{{name}}</a></li>
      {{/each}}
    </ul>
  </div>
</template>

<template name="account-form">
  {{> global-menu}}
  <form id='account-form' class='center page'>
    <h1>Who's involved?</h1>
    <ul>
      <li>
        <input type='text' placeholder='Name' value="{{name}}" data-input=account><a type='button' data-add-button data-item='{{name}}'>&check;</a>
      </li>
    {{#each accounts}}
    <li>
      <a data-link data-account='{{_id}}'>{{name}}</a><a type='button' data-remove-button data-account='{{_id}}'>&times;</a>
    </li>
    {{/each}}
    </ul>
  </form>
</template>

<template name="item-form">
  {{> global-menu}}
  <form id='item-form' class='center page'>
    <h1>What's involved?</h1>
    <ul>
      <li>
      <input type='text' placeholder='Name' value="{{name}}" data-input=name><input type='number' placeholder='$$$' data-input=amount min=0><a type='button' data-add-button data-item='{{name}}'>&check;</a>
      </li>
    {{#each items}}
    <li>
    <a data-link href='{{pathFor "item-detail-form"}}'>{{name}}<span class='pull-right'>${{#round}}{{amount}}{{/round}}</span></a></a><a type='button' data-remove-button data-item='{{_id}}' href='#'>&times;</a>
    </li>
    {{/each}}
    </ul>
  </form>
</template>

<template name='item-detail-form'>
  {{> global-menu}}
  <form id='item-detail-form' class='center page'>
    {{#if account}}
    <h1>Fill in the blank:</h1>
    <h1>{{account.name}} _____ {{item.name}}.</h1>
    <a data-use-drop-zone type=button>used</a>{{#unless payers}}<a data-both-drop-zone type=button>used &amp; paid for</a><a data-pay-drop-zone type=button>paid for</a>{{/unless}}<a data-pay-drop-zone type=button>did nothing with</a>
    {{/if}}
    {{#unless account}}
    <h1>Looks like we're done here!</h1>
    {{/unless}}
    <h1>The story of {{item.name}}:</h1>
    <ul data-story>
      {{#each users}}
      <li><a data-story-item data-link>{{name}} used {{item.name}}</a><a data-usage='{{usage}}' data-remove-button type=button>&times;</a></li>
      {{/each}}
      {{#each payers}}
      <li><a data-story-item data-link>{{name}} paid for {{item.name}}</a><a data-payment='{{payment}}' data-remove-button type=button>&times;</a></li>
      {{/each}}
    </ul>
  </form>
</template>

<template name='report'>
  {{> global-menu }}
  <div id='report' class='center page'>
    <h1>Here's what should happen:</h1>
    <ol>
      {{#each unsettledPayments}}
      <li><a data-link href='{{pathFor "report-payment-detail"}}'>{{fromAccount.name}} pays ${{#round}}{{amount}}{{/round}} to {{toAccount.name}}</a></li>
      {{/each}}
      {{#unless unsettledPayments}}
      <li>Nothing! You're already even!</li>
      {{/unless}}
    </ol>
    {{#each accounts}}
    <br>
    <h1>Breakdown for {{name}}:</h1>
    <h2>Incoming:</h2>
    <ul>
      {{#each incomingPayments}}
      <li><a data-link href='{{pathFor "report-payment-detail"}}' {{#unless settled}}class='highlight'{{/unless}}>{{name}}<span class='pull-right'>${{#round}}{{amount}}{{/round}}</span></a></a></li>
      {{/each}}
      {{#unless incomingPayments}}
      <li>Nothin'!</li>
      {{/unless}}
    </ul>
    <p>total: <span class='pull-right'>${{#round}}{{incomingTotal}}{{/round}}</span></p>
    <h2>Outgoing:</h2>
    <ul>
      {{#each outgoingPayments}}
      <li><a data-link href='{{pathFor "report-payment-detail"}}' {{#unless settled}}class='highlight'{{/unless}}>{{name}}<span class='pull-right'>${{#round}}{{amount}}{{/round}}</span></a></a></li>
      {{/each}}
      {{#unless outgoingPayments}}
      <li>Zilch!</li>
      {{/unless}}
    </ul>
    <p>total: <span class="pull-right">${{#round}}{{outgoingTotal}}{{/round}}</span></p>
    <h2>net total: <span class='pull-right'>${{#round}}{{outgoingTotal}}{{/round}} - ${{#round}}{{incomingTotal}}{{/round}} = ${{#round}}{{netTotal}}{{/round}}</span></h2>
    {{/each}}
  </div>
</template>

<template name='report-payment-detail'>
  {{> global-menu }}
  <div id='report-payment-detail' class='center page'>
    <h1>${{#round}}{{payment.amount}}{{/round}} from {{fromAccount.name}}{{#if toAccount}} to {{toAccount.name}}{{/if}}</h1>
    <h2>For:</h2>
    <ul>
      {{#each items}}
      <li><a data-link href="{{pathFor 'item-detail-form'}}">{{name}}<span class='pull-right'>${{#round}}{{amount}}{{/round}}</span></a></li>
      {{/each}}
    </ul>
  </div>
</template>

<template name='dump'>
  <h1>Report</h1>
  <ol>
    {{#each externalPayments}}
    <li>
    {{fromAccount.name}} paid ${{#round}}{{amount}}{{/round}} for {{#each items}}{{name}} {{/each}}
    </li>
    {{/each}}
    {{#each usages}}
    <li>{{fromAccount.name}} used {{item.name}}</li>
    {{/each}}
  </ol>
</template>
